import re
import time
import os
import sys
import uuid
from copy import copy

import pandas as pd
import collections

from win32com.client import Dispatch
from xml.etree.ElementTree import ElementTree
import xml.etree.ElementTree as ET
import csv
# from PyQt4 import QtGui, QtCore


def listit(t):
    return list(map(listit, t)) if isinstance(t, (list, tuple)) else t

# REF_EXCEL_PATH = "/../reference_files/OE_PE_JB_BTF_ICU 전원체계도(OE Power distribution)_R4_2020.12.15 - 복사본.xlsx"
# REF_EXCEL_PATH = "/../reference_files/SU2r_ICU_POWER DISTRIBUTION_210304_R14(M도면길이반영).xlsx"
REF_EXCEL_PATH = "/../reference_files/220317_SU2i EV T-CAR POWER DISTRIBUTION.xlsx"
#"Lib/site-packages/pip-19.0.3-py3.7.egg/reference_files/SU2r_ICU_POWER DISTRIBUTION_210304_R14(M도면길이반영).xlsx"
#"Lib/site-packages/pip-19.0.3-py3.7.egg/reference_files/220317_SU2i EV T-CAR POWER DISTRIBUTION.xlsx"
#SU2i_PS7i_E_R
#SU2i_PS7i_ICU
filename = os.path.dirname(__file__)+REF_EXCEL_PATH
xlApp = Dispatch("Excel.Application")
xlWb = xlApp.Workbooks.Open(filename)
print(filename)
# sheet = xlWb.Sheets('OE_ICU')
sheet = xlWb.Sheets('SU2i_PS7i_ICU')
# sheet = xlWb.Sheets('SU2r_ICU')
data = sheet.Range("A1:CC2000").Value

data = listit(data)

j = 1
# for i in range(len(sheet.Shapes)):
#     # print(i.TextFrame2.TextRange.Characters.Text)
#     print(j)
#     try:
#         print(sheet.Shapes(j).TextFrame2.TextRange.Characters.Text)
#     except:
#         pass
#     j = j + 1
temp_text_buffer = []
temp_text = ''
j = 0
for i in sheet.Shapes:
    #print("TextFrame2 Test : "+i.TextFrame2.TextRange.Characters.Text)
    # try:
    #     print("TextFrame2 Test : " + str(i.TextFrame.Characters(0,).Text))
    # except:
    #     pass
    try:
        temp_text = i.TextFrame2.TextRange.Text
        if temp_text != "":
            temp_text_buffer.append(temp_text)
            # print(temp_text)
        try:
            #print("TextFrame2 Test : " + str(i.TextFrame.Characters(0, ).Text))
            temp_text = str(i.TextFrame.Characters(0, ).Text)
            # print(temp_text)
            if temp_text != "":
                temp_text_buffer.append(temp_text)
                # print(temp_text)
        except:
            pass

    except:
        pass
    j = j + 1

# print(j)
xlWb.Close(True)

final_list = []
for i in data:
    for j in i:
        a = str(j).find("L_")
        b = str(j).find("A_")
        c = str(j).find("O_")
        d = str(j).find("P_")
        if a == 0 or b == 0 or c == 0 or d == 0:
            final_list.append(j)
            # print(j)
for i in temp_text_buffer:
    a = str(i).find("L_")
    b = str(i).find("A_")
    c = str(i).find("O_")
    d = str(i).find("P_")
    if a == 0 or b == 0 or c == 0 or d == 0:
        final_list.append(i)

for list in final_list:
    print(list)

# for i in sheet.Shapes:
#     print(i)

# PowerPoint = win32com.client.Dispatch(“PowerPoint.Application”)
# PowerPoint.Visible = True
# prs = PowerPoint.Presentations.Open(file_name)
# Word = win32com.client.Dispatch(“Word.Application”)
# Word.Visible = True
# Doc = Word.Documents.Add()
# for slide in prs.Slides:
#     for i, Shape in enumerate(slide.Shapes):
#         doc.Content.Paragraphs(i+1).Range.Text = Shape.TextFrame.TextRange.Text
# PowerPoint.Quit()